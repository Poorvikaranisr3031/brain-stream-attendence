<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Brain Stream Attendance – Face Count</title>
<style>
body { font-family: Arial; background: #0e1726; color: white; padding: 20px; }
.card { background:#1c2536; padding:15px; border-radius:10px; margin-bottom:20px; }
button { padding:10px 20px; border:0; border-radius:6px; cursor:pointer; }
#preview { max-width:100%; margin-top:10px; border-radius:10px; }
canvas { position:absolute; top:0; left:0; }
</style>
</head>
<body>

<h2>Brain Stream Attendance – Face Counting + PDF</h2>

<div class="card">
  <h3>Upload Class Photo</h3>
  <input type="file" id="fileInput" accept="image/*">
  <button onclick="detectFaces()">Detect Faces</button>
</div>

<div class="card">
  <h3>Result</h3>
  Total Faces: <span id="count">0</span>
  <div id="previewContainer" style="position:relative;">
    <img id="preview">
    <canvas id="overlay"></canvas>
  </div>
</div>

<div class="card">
  <h3>Attendance PDF</h3>
  <button onclick="downloadPDF()">Download PDF</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
let faces = [];

async function detectFaces() {
    const file = document.getElementById("fileInput").files[0];
    if (!file) { alert("Upload a photo."); return; }

    const img = document.getElementById("preview");
    img.src = URL.createObjectURL(file);

    await new Promise(r => img.onload = r);

    const canvas = document.getElementById("overlay");
    canvas.width = img.width;
    canvas.height = img.height;
    const ctx = canvas.getContext("2d");

    if (!("FaceDetector" in window)) {
        alert("Your browser does not support FaceDetector API.");
        return;
    }

    const detector = new FaceDetector({ fastMode: true });

    faces = await detector.detect(img);

    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.strokeStyle = "lime";
    ctx.lineWidth = 3;

    faces.forEach(face => {
        let { x,y,width,height } = face.boundingBox;
        ctx.strokeRect(x,y,width,height);
    });

    document.getElementById("count").textContent = faces.length;
}

function downloadPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.text("Brain Stream Attendance Report", 20, 20);
    doc.text("Total Faces Detected: " + faces.length, 20, 40);
    doc.save("attendance.pdf");
}
</script>

</body>
</html>
